---
title: "OSL Factorial ANOVA in R Using Data from Zhang et al. (2014)"
author: "Cory J. Cascalheira"
date: "December 3, 2018"
output:
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "~/GitHub/osl-zhang-et-al-2014/src")
```

# Open Stats Lab
___
Kevin P. McIntyre developed this amazing resource for students of psychology. Check out [Open Stats Lab](https://sites.trinity.edu/osl/) for a collection of all activities.

Each activity includes an article from *Psychological Science*, a data set, and an activity to complete in SPSS. However, if you are an open source fanatic, you could also complete the activity in [JASP](https://jasp-stats.org/). For tips on how to use JASP, check out [this resource](https://osf.io/t56kg/) created by Buchanan, Hopke, and Donaldson (2018).

I prefer to get my hands deep into the data. Dr. McIntyre does not *yet* offer an R activity to accompany the work of [Zhang et al. (2014)](https://journals.sagepub.com/stoken/default+domain/2CauuvIqpaIUiIdXSWh4/full), so here is one possible solution written in R.

# Analysis
___
I will perform assumption checks for each test prior to running it. We already know that the data meet all assumptions, otherwise the authors would have used a different analytic approach. However, checking the assumptions is helpful because:

1. reproducibility and accuracy can be verified; and
2. if you are a student, then you should form the habit of testing assumptions.

This analysis will follow the data science workflow advocated by [Garrett Grolemund and Hadley Wickham](https://r4ds.had.co.nz/introduction.html). First, we will set-up our session and import the data. Then, we must clean the data. Next, we will transform, model, and visualize the data to understand it. Finally, we will communicate our findings.

## Import
___
Let's load the packages necessary for this analysis into our workspace.

```{r message = FALSE}
library(psych) # describe data
library(broom) # coefficient-level information
library(car) # Levene's test, Anova function
library(nlme) # repeated measures ANOVA
library(multcomp) # post-hoc measures
library(tidyverse) # utility and visualization
```

We can import the dataset using a relative path because our working directory is set.

```{r message = FALSE}
zhang <- read_csv("../data/Zhang et al. 2014 Study 3.csv")
```

## Clean
___
What do the data look like?

```{r}
glimpse(zhang)
```

For this analysis, we only need the first seven variables. Let's `select()` them using `snake_case` and abbreviation.

```{r}
zhang_clean <- zhang %>%
  select(
    condition = Condition,
    t1_extra = T1_Extraordinariness,
    t2_extra = T2_Extraordinariness,
    t1_curious = T1_Predicted_Curious,
    t2_curious = T2_Actual_Curious,
    t1_interest = T1_Predicted_Interest_Composite,
    t2_interest = T2_Actual_Interest_Composite
  )
```

Make condition a between-subjects factor with appropriate labels. Since the ordinary condition is mentioned first throughout the article, we can assume that 1 corresponds to ordinary. If our analyses do not match those reported in the paper, then it will be important to return to this step.

```{r}
zhang_clean <- within(zhang_clean, {
  condition <- factor(condition, labels = c("ordinary", "extraordinary"))
})
```

How many participants are in each condition?

```{r}
zhang_clean %>% count(condition)
```

Thus, we have an unbalanced design. 

## Understand
___
This study is truly a factorial design. It combines within-subjects and between-subjects factors. We must perform repeated measures ANOVA because [all participants received all conditions](http://www.discoveringstatistics.com/docs/repeatedmeasures.pdf).

We will test for mean differences between conditions and between time points, running post-hoc tests to discover which condition/time combination is significant. The null and altnerative hypotheses are:

$$H_0: \mu_1 = \mu_2 = \mu_3 = \dots = \mu_k \\ H_1: \text{at least two means are significantly different}$$

The **repeated measures mixed ANOVA** has [six assumptions](https://statistics.laerd.com/spss-tutorials/mixed-anova-using-spss-statistics.php), two of which are met through experimental design:

1. **Continuous dependent variable** at the interval or ratio level.

2. **Categorical independent variables** as factors with two or more levels that can be:
    - *within-subjects*, such as the two different time points, or
    - *between-subjects*, such as two different conditions.

3. **No significant outliers** in any level combination of the within-subjects factor or between-subjects factor. Outliers skew data, distort the differences between related groups, and affect normality. 

4. **Approximately normal distribution** of the dependent variable for each level combination of both the within-subjects and between-subjects factors. Since ANOVA is robust, mild violations of normality can be tolerated if the number of observations is uniform across levels, or when the sample size is large, `n >= 30`. The assumption assesses the distribution of residuals with the Shapiro-Wilk test, density curves, Q-Q plots, or histograms.

5. **Homogeneity of variances** for each combination of the groups of the two within-subjects and between-subjects factors. Assessed with Levene's test.

6. **Sphericity**, which states that the differences in variances between the related groups of the within-subjects factor for all groups of the between-subjects factor (i.e., dependent variable) are equal. [This assumption](https://www.sheffield.ac.uk/polopoly_fs/1.531222!/file/MASH_repeated_measures_ANOVA_SPSS.pdf) *must* be met. It is assessed with Mauchley's test. If *p* > 0.05, sphericity can be assumed. If the test is significant, then use the Greenhouse-Geisser correction.

### Manipulation Check of Extraordinariness {.tabset .tabset-pills}

Do participants in the extraordinary condition actually perceive Valentine's Day to be more extraordinary than participants rating a normal day?

We can answer this with a simple one-way between-groups ANOVA.

**Note**: the *F*-value will not match the statistic reported in the original paper.

```{r}
# Create analysis of variance
t1_extra_aov <- aov(t1_extra ~ condition, data = zhang_clean)

# Summarize one-way ANOVA
Anova(t1_extra_aov)
```

#### Outliers?

#### Normality?

#### Homoscedasticity?

### Extraordinariness Over Time

## Communicate
___

# Acknowledgements
___
I am thankful for my advisor, Dr. Brandt A. Smith for introducing me to R, JASP, and OSL. The discipline of psychology is advocating for preregistered, open materials. His encouragement to utilize open data and open source software has positioned me in the middle of the reproducible movement.

I would still be clicking checkboxes and dropdowns to analyze data if it were not for [DataCamp](https://www.datacamp.com), [Rose Maier](https://rstudio-pubs-static.s3.amazonaws.com/65059_586f394d8eb84f84b1baaf56ffb6b47f.html), [Alboukadel Kassambara](http://www.sthda.com/english/wiki/r-software), [Jonathan Baron](https://www.sas.upenn.edu/~baron/from_cattell/rpsych/rpsych.html#htoc60), and the team behind [personality-project](http://personality-project.org/r/r.guide.html#withinone).

## Dependencies
This activity was completed using RStudio.

```{r}
devtools::session_info()
```